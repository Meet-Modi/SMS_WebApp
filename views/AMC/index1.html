<!DOCTYPE html>
<html lang="en">
<head>
    <title>SDE | DashBoard</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--===============================================================================================-->
    <link rel="icon" type="image/png" href="images/icons/logo.png"/>
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="css/util.css">
    <link rel="stylesheet" type="text/css" href="css/custom.css">
    <!--===============================================================================================-->
    
    <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- DataTables -->
    <link rel="stylesheet" href="plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/adminlte.min.css">
    <!-- Google Font: Source Sans Pro -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
    <!--===============================================================================================-->
    
</head>
<body class="animsition">
    <?php
    $cookie_name = "jwt_token";
    if(isset($_POST['jwt_token'])){
        $jwt_token = $_POST["jwt_token"];
        $cookie_name = "jwt_token"; 
        $cookie_value = $jwt_token;
        // 86400 = 1 day 
        setcookie($cookie_name, $cookie_value, time() + 3600, "/"); 
    }
    else{
        if(isset($_COOKIE[$cookie_name])) { 
            echo "Cookie named '" . $cookie_name . "' is set!";
            $jwt_token = $_COOKIE[$cookie_name]; 
        } 
        else{
            header("Location: ../../index.html");
            exit();
        }		
    }
    
    $myObj = (object)array();
    $myObj->jwt = $jwt_token;
    $myJSON = json_encode($myObj);
    
    $ch = curl_init();
    
    curl_setopt($ch, CURLOPT_URL,            "http://localhost/SMS_WebApp/api/employee/validate_token.php" );
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1 );
    curl_setopt($ch, CURLOPT_POST,           1 );
    curl_setopt($ch, CURLOPT_POSTFIELDS,     $myJSON ); 
    curl_setopt($ch, CURLOPT_HTTPHEADER,     array('Content-Type: text/plain')); 
    
    $result=curl_exec ($ch);
    $data = json_decode($result);
    $userid = $data->data->userid;
    $firstname = $data->data->firstname;
    $lastname = $data->data->lastname;
    ?>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script>
        var userid = "<?php echo($userid);?>";
        var firstname = "<?php echo($firstname);?>";
        var lastname = "<?php echo($lastname); ?>"; 
        
        var obj = { operation: "R", R: "R"};
        console.log("input : " + JSON.stringify(obj));			
        var html = "";
        $.post( "http://localhost/SMS_WebApp/api/amc/RD_amc.php", JSON.stringify(obj) ,function(data) {    
            for(var i = 0; i < data.length; i++) {
                html += "<tr>";
                html += "<td>" + data[i].amcid + "</td>";
                html += "<td>" + data[i].customerid + "</td>";                
                html += "<td></td>";
                html += "<td>" + data[i].amctypeid + "</td>";
                html += "<td>" + data[i].fromdate + "</td>";
                html += "<td>" + data[i].period + "</td>";
                html += "<td>" + data[i].quantity + "</td>";
                html += "<td>" + data[i].totalservices + "</td>";
                html += "<td>" + data[i].amount + "</td>";
                html += "<td><div class='row'><a href='ViewAMC.html?amc_id=" + data[i].amcid + "'class='w-size0 bg4 bo-rad-23 hov1 trans-0-4' style='border: none;'>View/Update</a></div></td>";
                html += "</tr>";
            }
            $("#amc-table").html(html);    
        }, "json")
    </script>
    
    
    <div class="header1" id="navbar"></div>
    <div class="wrapper tablepostion">
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <a href='AddAMC.html' class='flex-c-m size2 bg4 bo-rad-23 hov1 m-text3 trans-0-4' name="AddEmployee" value="AddEmployee" style="width:20%;">New AMC
                                </a>			
                            </div>
                            <div class="card-body">
                                <table id="example2" class="table table-bordered table-hover">
                                    <thead>
                                        <tr>
                                            <th>AMC ID</th>
                                            <th>Customer ID</th>
                                            <th>Billing Name</th>
                                            <th>AMC Type</th>
                                            <th>From Date</th>
                                            <th>Period (in years)</th>
                                            <th>Quantity</th>
                                            <th>No. of Services</th>
                                            <th>Amount</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="amc-table">
                                    </tbody>
                                        <tfoot>
                                            <tr>
                                                <th>AMC ID</th>
                                                <th>Customer ID</th>
                                                <th>Billing Name</th>
                                                <th>AMC Type</th>
                                                <th>From Date</th>
                                                <th>Period (in years)</th>
                                                <th>Quantity</th>
                                                <th>No. of Services</th>
                                                <th>Amount</th>
                                                <th>Action</th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>    
        <!--===============================================================================================-->
        <script type="text/javascript" src="vendor/jquery/jquery-3.2.1.min.js"></script>
        <!--===============================================================================================-->
        <script type="text/javascript" src="vendor/animsition/js/animsition.min.js"></script>
        <!--===============================================================================================-->
        <script type="text/javascript" src="vendor/bootstrap/js/popper.js"></script>
        <script type="text/javascript" src="vendor/bootstrap/js/bootstrap.min.js"></script>
        <!--===============================================================================================-->
        <script src="js/main.js"></script>
        <script src="../NavBar/NavBar.js"></script>
        <!--===============================================================================================-->
        
        <!-- jQuery -->
        <script src="plugins/jquery/jquery.min.js"></script>
        <!-- Bootstrap 4 -->
        <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
        <!-- DataTables -->
        <script src="plugins/datatables/jquery.dataTables.min.js"></script>
        <script src="plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
        <script src="plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
        <script src="plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
        <!-- AdminLTE App -->
        <script src="dist/js/adminlte.min.js"></script>
        <!-- AdminLTE for demo purposes -->
        <script src="dist/js/demo.js"></script>
        <!-- page script -->
        <script>
            $(function () {
                $("#example1").DataTable({
                    "responsive": true,
                    "autoWidth": true,
                });
                $('#example2').DataTable({
                    "paging": true,
                    "lengthChange": true,
                    "searching": true,
                    "ordering": true,
                    "info": true,
                    "autoWidth": true,
                    "responsive": true,
                });
            });
        </script>
        
        <script>
            $(document).ready(function(){
                showNavBar(userid,firstname,lastname);
                
                $('.js-show-header-dropdown').on('click', function(){
                    $(this).parent().find('.header-dropdown')
                });
                
                var menu = $('.js-show-header-dropdown');
                var sub_menu_is_showed = -1;
                
                for(var i=0; i<menu.length; i++){
                    $(menu[i]).on('click', function(){ 
                        
                        if(jQuery.inArray( this, menu ) == sub_menu_is_showed){
                            $(this).parent().find('.header-dropdown').toggleClass('show-header-dropdown');
                            sub_menu_is_showed = -1;
                        }
                        else {
                            for (var i = 0; i < menu.length; i++) {
                                $(menu[i]).parent().find('.header-dropdown').removeClass("show-header-dropdown");
                            }
                            
                            $(this).parent().find('.header-dropdown').toggleClass('show-header-dropdown');
                            sub_menu_is_showed = jQuery.inArray( this, menu );
                        }
                    });
                }
                
                $(".js-show-header-dropdown, .header-dropdown").click(function(event){
                    event.stopPropagation();
                });
                
                $(window).on("click", function(){
                    for (var i = 0; i < menu.length; i++) {
                        $(menu[i]).parent().find('.header-dropdown').removeClass("show-header-dropdown");
                    }
                    sub_menu_is_showed = -1;
                });
            });
        </script>
        
        
        <script>
            
        </script>
    </body>
    </html>
    