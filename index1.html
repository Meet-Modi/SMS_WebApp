<!DOCTYPE html>
<html lang="en">
<head>
	<title>System Design & Engineeering</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<!--===============================================================================================-->	
	<link rel="icon" type="image/png" href="images/icons/favicon.ico"/>
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
	<link rel="stylesheet" type="text/css" href="css/custom.css">
<!--===============================================================================================-->
</head>
<body>
	
	<div id="response"></div>
	<div id="content">
		<a class="nav-item nav-link" href="#" id='login'>Login</a>
        <a class="nav-item nav-link" href="#" id='sign_up'>Sign Up</a>
	</div>


<script>
	// jQuery codes
	$(document).ready(function(){
	    // show sign up / registration form
	    $(document).on('click', '#sign_up', function(){
	 
	        var html = `
	            <h2>Sign Up</h2>
	            <form id='sign_up_form'>
	                <div class="form-group">
	                    <label for="firstname">Firstname</label>
	                    <input type="text" class="form-control" name="firstname" id="firstname" required />
	                </div>
	 
	                <div class="form-group">
	                    <label for="lastname">Lastname</label>
	                    <input type="text" class="form-control" name="lastname" id="lastname" required />
	                </div>
	 
	                <div class="form-group">
	                    <label for="email">Email</label>
	                    <input type="email" class="form-control" name="email" id="email" required />
	                </div>
	 
	                <div class="form-group">
	                    <label for="password">Password</label>
	                    <input type="password" class="form-control" name="password" id="password" required />
	                </div>
	 
	                <button type='submit' class='btn btn-primary'>Sign Up</button>
	            </form>
	            `;
	 
	        clearResponse();
	        $('#content').html(html);
	    });
	 
	    // trigger when registration form is submitted
		$(document).on('submit', '#sign_up_form', function(){
		 
		    // get form data
		    var sign_up_form=$(this);
		    var form_data=JSON.stringify(sign_up_form.serializeObject());
		 
		    // submit form data to api
		    $.ajax({
		        url: "api/create_user.php",
		        type : "POST",
		        contentType : 'application/json',
		        data : form_data,
		        success : function(result) {
		            // if response is a success, tell the user it was a successful sign up & empty the input boxes
		            $('#response').html("<div class='alert alert-success'>Successful sign up. Please login.</div>");
		            sign_up_form.find('input').val('');
		        },
		        error: function(xhr, resp, text){
		            // on error, tell the user sign up failed
		            $('#response').html("<div class='alert alert-danger'>Unable to sign up. Please contact admin.</div>");
		        }
		    });
		 
		    return false;
		});
	 
	    // show login form
		$(document).on('click', '#login', function(){
		    showLoginPage();
		});
	 
		// trigger when login form is submitted
		$(document).on('submit', '#login_form', function(){
		 
		    // get form data
		    var login_form=$(this);
		    var form_data=JSON.stringify(login_form.serializeObject());
		 
		    // submit form data to api
			$.ajax({
			    url: "api/login.php",
			    type : "POST",
			    contentType : 'application/json',
			    data : form_data,
			    success : function(result){
			 
			        // store jwt to cookie
			        setCookie("jwt", result.jwt, 1);
			 
			        // show home page & tell the user it was a successful login
			        showHomePage();
			        $('#response').html("<div class='alert alert-success'>Successful login.</div>");
			 
			    },
			    error: function(xhr, resp, text){
				    // on error, tell the user login has failed & empty the input boxes
				    $('#response').html("<div class='alert alert-danger'>Login failed. Email or password is incorrect.</div>");
				    login_form.find('input').val('');
				}
			});
		    return false;
		});
	 
		// trigger to show home page will be here
	 
	    // remove any prompt messages
		function clearResponse(){
		    $('#response').html('');
		}
		 
		// showLoginPage() will be here
		function showLoginPage(){
		 
		    // remove jwt
		    setCookie("jwt", "", 1);
		 
		    // login page html
		    var html = `
		        <h2>Login</h2>
		        <form id='login_form'>
		            <div class='form-group'>
		                <label for='email'>Email address</label>
		                <input type='email' class='form-control' id='email' name='email' placeholder='Enter email'>
		            </div>
		 
		            <div class='form-group'>
		                <label for='password'>Password</label>
		                <input type='password' class='form-control' id='password' name='password' placeholder='Password'>
		            </div>
		 
		            <button type='submit' class='btn btn-primary'>Login</button>
		        </form>
		        `;
		 
		    $('#content').html(html);
		    clearResponse();
		    showLoggedOutMenu();
		}
	 
		// function to set cookie
		function setCookie(cname, cvalue, exdays) {
		    var d = new Date();
		    d.setTime(d.getTime() + (exdays*24*60*60*1000));
		    var expires = "expires="+ d.toUTCString();
		    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
		}
	 
		// if the user is logged out
		function showLoggedOutMenu(){
		    // show login and sign up from navbar & hide logout button
		    $("#login, #sign_up").show();
		    $("#logout").hide();
		}
	 
		// show home page
		function showHomePage(){
		 
		    // validate jwt to verify access
		    var jwt = getCookie('jwt');
		    $.post("api/validate_token.php", JSON.stringify({ jwt:jwt })).done(function(result) {
		 
		        // home page html will be here
		    })
		 
		    // show login page on error will be here
		}
		 
		// get or read cookie
		function getCookie(cname){
		    var name = cname + "=";
		    var decodedCookie = decodeURIComponent(document.cookie);
		    var ca = decodedCookie.split(';');
		    for(var i = 0; i <ca.length; i++) {
		        var c = ca[i];
		        while (c.charAt(0) == ' '){
		            c = c.substring(1);
		        }
		 
		        if (c.indexOf(name) == 0) {
		            return c.substring(name.length, c.length);
		        }
		    }
		    return "";
		}
		 
		// showLoggedInMenu() will be here 
		
		// function to make form values to json format
		$.fn.serializeObject = function(){
		 
		    var o = {};
		    var a = this.serializeArray();
		    $.each(a, function() {
		        if (o[this.name] !== undefined) {
		            if (!o[this.name].push) {
		                o[this.name] = [o[this.name]];
		            }
		            o[this.name].push(this.value || '');
		        } else {
		            o[this.name] = this.value || '';
		        }
		    });
		    return o;
		};
	});
</script>




</body>


</html>